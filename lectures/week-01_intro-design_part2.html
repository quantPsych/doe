<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Davood Tofighi, Ph.D.">

<title>Planning Experiments – STAT 454/545 - Analysis of Variance and Experimental Design</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../assets/images/favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-1092c56c6cadf2eb47b1bc8063ab382a.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-aff2639e191a0a8d05f4f3608923e904.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<meta name="mermaid-theme" content="neutral">
<script src="../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">
<link href="../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;family=Montserrat:wght@400;700&amp;family=Fira+Code:wght@400;700&amp;display=swap" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../assets/styles/css/home.css">
<meta property="og:title" content="Planning Experiments – STAT 454/545 - Analysis of Variance and Experimental Design">
<meta property="og:description" content="Analysis of Variance and Experimental Design">
<meta property="og:image" content="https://Data-Wise.github.io/doe/lectures/assets/images/logo.png">
<meta property="og:site_name" content="STAT 454/545 - Analysis of Variance and Experimental Design">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">STAT 454/545 - Analysis of Variance and Experimental Design</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus/syllabus-final.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_lectures.html"> 
<span class="menu-text">Lecture Notes</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus/schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_assignments.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../contents.html"> 
<span class="menu-text">Contents</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../home_appendix.html"> 
<span class="menu-text">Appendix</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Planning Experiments</h1>
                      </div>
  </div>
    
  <div class="quarto-title-meta-author column-page-left">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author">Davood Tofighi, Ph.D. </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Department of Mathematics and Statistics, University of New Mexico
            </p>
        </div>
    </div>

  <div class="quarto-title-meta column-page-left">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">25-Dec-2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="-1">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#planning-experiments" id="toc-planning-experiments" class="nav-link active" data-scroll-target="#planning-experiments">Planning Experiments</a></li>
  <li><a href="#objectives" id="toc-objectives" class="nav-link" data-scroll-target="#objectives">Objectives</a>
  <ul class="collapse">
  <li><a href="#readings" id="toc-readings" class="nav-link" data-scroll-target="#readings">Readings</a></li>
  </ul></li>
  <li><a href="#checklist-for-experimental-design" id="toc-checklist-for-experimental-design" class="nav-link" data-scroll-target="#checklist-for-experimental-design">Checklist for Experimental Design</a>
  <ul class="collapse">
  <li><a href="#steps-in-planning-an-experiment" id="toc-steps-in-planning-an-experiment" class="nav-link" data-scroll-target="#steps-in-planning-an-experiment">Steps in Planning an Experiment</a>
  <ul class="collapse">
  <li><a href="#define-the-objectives-of-the-experiment" id="toc-define-the-objectives-of-the-experiment" class="nav-link" data-scroll-target="#define-the-objectives-of-the-experiment">1. Define the Objectives of the Experiment</a></li>
  <li><a href="#identify-all-sources-of-variation" id="toc-identify-all-sources-of-variation" class="nav-link" data-scroll-target="#identify-all-sources-of-variation">2. Identify All Sources of Variation</a></li>
  <li><a href="#choose-a-rule-for-assigning-experimental-units-to-treatments" id="toc-choose-a-rule-for-assigning-experimental-units-to-treatments" class="nav-link" data-scroll-target="#choose-a-rule-for-assigning-experimental-units-to-treatments">3. Choose a Rule for Assigning Experimental Units to Treatments</a></li>
  <li><a href="#specify-the-measurements-procedure-and-anticipated-difficulties" id="toc-specify-the-measurements-procedure-and-anticipated-difficulties" class="nav-link" data-scroll-target="#specify-the-measurements-procedure-and-anticipated-difficulties">4. Specify the Measurements, Procedure, and Anticipated Difficulties</a></li>
  <li><a href="#run-a-pilot-experiment" id="toc-run-a-pilot-experiment" class="nav-link" data-scroll-target="#run-a-pilot-experiment">5. Run a Pilot Experiment</a></li>
  <li><a href="#specify-the-statistical-model" id="toc-specify-the-statistical-model" class="nav-link" data-scroll-target="#specify-the-statistical-model">6. Specify the Statistical Model</a></li>
  <li><a href="#outline-the-analysis" id="toc-outline-the-analysis" class="nav-link" data-scroll-target="#outline-the-analysis">7. Outline the Analysis</a></li>
  <li><a href="#calculate-sample-size" id="toc-calculate-sample-size" class="nav-link" data-scroll-target="#calculate-sample-size">8. Calculate Sample Size</a></li>
  <li><a href="#review-and-revise" id="toc-review-and-revise" class="nav-link" data-scroll-target="#review-and-revise">9. Review and Revise</a></li>
  </ul></li>
  <li><a href="#flowchart-of-experimental-design-steps" id="toc-flowchart-of-experimental-design-steps" class="nav-link" data-scroll-target="#flowchart-of-experimental-design-steps">Flowchart of Experimental Design Steps</a></li>
  </ul></li>
  <li><a href="#explaining-experimental-design-concepts" id="toc-explaining-experimental-design-concepts" class="nav-link" data-scroll-target="#explaining-experimental-design-concepts">Explaining Experimental Design Concepts</a>
  <ul class="collapse">
  <li><a href="#identifying-experiment-objectives-and-variation-sources" id="toc-identifying-experiment-objectives-and-variation-sources" class="nav-link" data-scroll-target="#identifying-experiment-objectives-and-variation-sources">Identifying Experiment Objectives and Variation Sources</a>
  <ul class="collapse">
  <li><a href="#setting-objectives" id="toc-setting-objectives" class="nav-link" data-scroll-target="#setting-objectives">Setting Objectives</a></li>
  <li><a href="#variation-sources" id="toc-variation-sources" class="nav-link" data-scroll-target="#variation-sources">Variation Sources</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example">Example</a></li>
  <li><a href="#activity-work-out-experiment-think-pair-share" id="toc-activity-work-out-experiment-think-pair-share" class="nav-link" data-scroll-target="#activity-work-out-experiment-think-pair-share">Activity (Work Out Experiment): Think-Pair-Share</a></li>
  <li><a href="#challenges-and-common-mistakes" id="toc-challenges-and-common-mistakes" class="nav-link" data-scroll-target="#challenges-and-common-mistakes">Challenges and Common Mistakes</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  </ul></li>
  <li><a href="#treatment-factors-and-levels" id="toc-treatment-factors-and-levels" class="nav-link" data-scroll-target="#treatment-factors-and-levels">Treatment Factors and Levels</a>
  <ul class="collapse">
  <li><a href="#defining-treatment-factors" id="toc-defining-treatment-factors" class="nav-link" data-scroll-target="#defining-treatment-factors">Defining Treatment Factors</a></li>
  <li><a href="#factor-levels" id="toc-factor-levels" class="nav-link" data-scroll-target="#factor-levels">Factor Levels</a></li>
  <li><a href="#activity-baking-experiment-design-your-own-factorial-experiment" id="toc-activity-baking-experiment-design-your-own-factorial-experiment" class="nav-link" data-scroll-target="#activity-baking-experiment-design-your-own-factorial-experiment">Activity (Baking Experiment): Design Your Own Factorial Experiment</a></li>
  <li><a href="#challenges-and-common-mistakes-1" id="toc-challenges-and-common-mistakes-1" class="nav-link" data-scroll-target="#challenges-and-common-mistakes-1">Challenges and Common Mistakes</a></li>
  <li><a href="#exercises-1" id="toc-exercises-1" class="nav-link" data-scroll-target="#exercises-1">Exercises</a></li>
  </ul></li>
  <li><a href="#experimental-units-blocking-and-nuisance-factors" id="toc-experimental-units-blocking-and-nuisance-factors" class="nav-link" data-scroll-target="#experimental-units-blocking-and-nuisance-factors">Experimental Units, Blocking, and Nuisance Factors</a>
  <ul class="collapse">
  <li><a href="#experimental-units" id="toc-experimental-units" class="nav-link" data-scroll-target="#experimental-units">Experimental Units</a></li>
  <li><a href="#examples-of-experimental-units" id="toc-examples-of-experimental-units" class="nav-link" data-scroll-target="#examples-of-experimental-units">Examples of Experimental Units</a></li>
  <li><a href="#blocking-factors" id="toc-blocking-factors" class="nav-link" data-scroll-target="#blocking-factors">Blocking Factors</a></li>
  <li><a href="#noise-factors-and-covariates" id="toc-noise-factors-and-covariates" class="nav-link" data-scroll-target="#noise-factors-and-covariates">Noise Factors and Covariates</a></li>
  <li><a href="#factor-classification-flowchart" id="toc-factor-classification-flowchart" class="nav-link" data-scroll-target="#factor-classification-flowchart">Factor Classification Flowchart</a></li>
  <li><a href="#activity-blocking-brainstorm" id="toc-activity-blocking-brainstorm" class="nav-link" data-scroll-target="#activity-blocking-brainstorm">Activity: Blocking Brainstorm</a></li>
  <li><a href="#challenges-and-common-mistakes-2" id="toc-challenges-and-common-mistakes-2" class="nav-link" data-scroll-target="#challenges-and-common-mistakes-2">Challenges and Common Mistakes</a></li>
  <li><a href="#exercises-2" id="toc-exercises-2" class="nav-link" data-scroll-target="#exercises-2">Exercises</a></li>
  </ul></li>
  <li><a href="#principles-of-randomization" id="toc-principles-of-randomization" class="nav-link" data-scroll-target="#principles-of-randomization">Principles of Randomization</a>
  <ul class="collapse">
  <li><a href="#randomization-concept" id="toc-randomization-concept" class="nav-link" data-scroll-target="#randomization-concept">Randomization Concept</a></li>
  <li><a href="#how-to-perform-randomization" id="toc-how-to-perform-randomization" class="nav-link" data-scroll-target="#how-to-perform-randomization">How to Perform Randomization</a></li>
  <li><a href="#pseudocode-for-randomization" id="toc-pseudocode-for-randomization" class="nav-link" data-scroll-target="#pseudocode-for-randomization"><strong>Pseudocode for Randomization</strong></a></li>
  <li><a href="#r-implementation-randomization-examples" id="toc-r-implementation-randomization-examples" class="nav-link" data-scroll-target="#r-implementation-randomization-examples">R Implementation: Randomization Examples</a></li>
  <li><a href="#explanation-in-r" id="toc-explanation-in-r" class="nav-link" data-scroll-target="#explanation-in-r">Explanation in R</a></li>
  <li><a href="#r-example-simple-random-assignment" id="toc-r-example-simple-random-assignment" class="nav-link" data-scroll-target="#r-example-simple-random-assignment">R Example: Simple Random Assignment</a></li>
  <li><a href="#activity-randomization-drill" id="toc-activity-randomization-drill" class="nav-link" data-scroll-target="#activity-randomization-drill">Activity: Randomization Drill</a></li>
  <li><a href="#challenges-and-common-mistakes-3" id="toc-challenges-and-common-mistakes-3" class="nav-link" data-scroll-target="#challenges-and-common-mistakes-3">Challenges and Common Mistakes</a></li>
  <li><a href="#exercises-3" id="toc-exercises-3" class="nav-link" data-scroll-target="#exercises-3">Exercises</a></li>
  </ul></li>
  <li><a href="#standard-experimental-designs" id="toc-standard-experimental-designs" class="nav-link" data-scroll-target="#standard-experimental-designs">Standard Experimental Designs</a>
  <ul class="collapse">
  <li><a href="#completely-randomized-design-crd" id="toc-completely-randomized-design-crd" class="nav-link" data-scroll-target="#completely-randomized-design-crd">Completely Randomized Design (CRD)</a></li>
  <li><a href="#randomized-block-design-rbd" id="toc-randomized-block-design-rbd" class="nav-link" data-scroll-target="#randomized-block-design-rbd">Randomized Block Design (RBD)</a></li>
  <li><a href="#row-column-and-latin-squares" id="toc-row-column-and-latin-squares" class="nav-link" data-scroll-target="#row-column-and-latin-squares">Row-Column and Latin Squares</a></li>
  <li><a href="#factorial-designs" id="toc-factorial-designs" class="nav-link" data-scroll-target="#factorial-designs">Factorial Designs</a></li>
  <li><a href="#split-plot-designs" id="toc-split-plot-designs" class="nav-link" data-scroll-target="#split-plot-designs">Split-Plot Designs</a></li>
  <li><a href="#activity-design-match-up" id="toc-activity-design-match-up" class="nav-link" data-scroll-target="#activity-design-match-up">Activity: Design Match-Up</a></li>
  <li><a href="#challenges-and-common-mistakes-4" id="toc-challenges-and-common-mistakes-4" class="nav-link" data-scroll-target="#challenges-and-common-mistakes-4">Challenges and Common Mistakes</a></li>
  <li><a href="#exercises-4" id="toc-exercises-4" class="nav-link" data-scroll-target="#exercises-4">Exercises</a></li>
  </ul></li>
  <li><a href="#model-specification-and-effect-types" id="toc-model-specification-and-effect-types" class="nav-link" data-scroll-target="#model-specification-and-effect-types">Model Specification and Effect Types</a>
  <ul class="collapse">
  <li><a href="#linear-models-and-anova" id="toc-linear-models-and-anova" class="nav-link" data-scroll-target="#linear-models-and-anova">Linear Models and ANOVA</a></li>
  <li><a href="#fixed-vs.-random-effects" id="toc-fixed-vs.-random-effects" class="nav-link" data-scroll-target="#fixed-vs.-random-effects">Fixed vs.&nbsp;Random Effects</a></li>
  <li><a href="#activity-fixed-or-random" id="toc-activity-fixed-or-random" class="nav-link" data-scroll-target="#activity-fixed-or-random">Activity: Fixed or Random?</a></li>
  <li><a href="#challenges-and-common-mistakes-5" id="toc-challenges-and-common-mistakes-5" class="nav-link" data-scroll-target="#challenges-and-common-mistakes-5">Challenges and Common Mistakes</a></li>
  <li><a href="#exercises-5" id="toc-exercises-5" class="nav-link" data-scroll-target="#exercises-5">Exercises</a></li>
  </ul></li>
  <li><a href="#planning-data-collection-and-pilot-experiments" id="toc-planning-data-collection-and-pilot-experiments" class="nav-link" data-scroll-target="#planning-data-collection-and-pilot-experiments">Planning Data Collection and Pilot Experiments</a>
  <ul class="collapse">
  <li><a href="#measurement-and-procedure" id="toc-measurement-and-procedure" class="nav-link" data-scroll-target="#measurement-and-procedure">Measurement and Procedure</a></li>
  <li><a href="#pilot-experiments" id="toc-pilot-experiments" class="nav-link" data-scroll-target="#pilot-experiments">Pilot Experiments</a></li>
  <li><a href="#activity-pilot-study-discussion" id="toc-activity-pilot-study-discussion" class="nav-link" data-scroll-target="#activity-pilot-study-discussion">Activity: Pilot Study Discussion</a></li>
  <li><a href="#challenges-and-common-mistakes-6" id="toc-challenges-and-common-mistakes-6" class="nav-link" data-scroll-target="#challenges-and-common-mistakes-6">Challenges and Common Mistakes</a></li>
  <li><a href="#exercises-6" id="toc-exercises-6" class="nav-link" data-scroll-target="#exercises-6">Exercises</a></li>
  </ul></li>
  <li><a href="#determining-the-number-of-observations" id="toc-determining-the-number-of-observations" class="nav-link" data-scroll-target="#determining-the-number-of-observations">Determining the Number of Observations</a>
  <ul class="collapse">
  <li><a href="#sample-size-and-power" id="toc-sample-size-and-power" class="nav-link" data-scroll-target="#sample-size-and-power">Sample Size and Power</a></li>
  <li><a href="#activity-sample-size-calculation" id="toc-activity-sample-size-calculation" class="nav-link" data-scroll-target="#activity-sample-size-calculation">Activity: Sample Size Calculation</a></li>
  <li><a href="#challenges-and-common-mistakes-7" id="toc-challenges-and-common-mistakes-7" class="nav-link" data-scroll-target="#challenges-and-common-mistakes-7">Challenges and Common Mistakes</a></li>
  <li><a href="#exercises-7" id="toc-exercises-7" class="nav-link" data-scroll-target="#exercises-7">Exercises</a></li>
  </ul></li>
  <li><a href="#practical-example-in-r" id="toc-practical-example-in-r" class="nav-link" data-scroll-target="#practical-example-in-r">Practical Example in R</a>
  <ul class="collapse">
  <li><a href="#example-a-simple-crd" id="toc-example-a-simple-crd" class="nav-link" data-scroll-target="#example-a-simple-crd">Example: A Simple CRD</a></li>
  <li><a href="#r-code" id="toc-r-code" class="nav-link" data-scroll-target="#r-code">R Code</a></li>
  <li><a href="#activity-interpret-r-output" id="toc-activity-interpret-r-output" class="nav-link" data-scroll-target="#activity-interpret-r-output">Activity: Interpret R Output</a></li>
  <li><a href="#challenges-and-common-mistakes-8" id="toc-challenges-and-common-mistakes-8" class="nav-link" data-scroll-target="#challenges-and-common-mistakes-8">Challenges and Common Mistakes</a></li>
  <li><a href="#exercises-8" id="toc-exercises-8" class="nav-link" data-scroll-target="#exercises-8">Exercises</a></li>
  </ul></li>
  <li><a href="#summary-of-key-takeaways" id="toc-summary-of-key-takeaways" class="nav-link" data-scroll-target="#summary-of-key-takeaways">Summary of Key Takeaways</a></li>
  <li><a href="#definitions-of-key-terms" id="toc-definitions-of-key-terms" class="nav-link" data-scroll-target="#definitions-of-key-terms">Definitions of Key Terms</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block page-columns page-full column-page-left" id="quarto-document-content">





<section id="planning-experiments" class="level1">
<h1>Planning Experiments</h1>
<p>Experimental design forms the foundation of scientific inquiry whenever the goal is to understand how certain controllable inputs (factors) influence outcomes (responses). By carefully planning how to collect data and assigning treatments to experimental units, we can draw valid causal inferences about these relationships. Unlike observational studies, experiments involve actively manipulating factors to reveal their effects while controlling for unwanted variability.</p>
<p>This set of lecture notes provides a comprehensive overview of experimental design concepts and applications. We will address how to define clear objectives, classify sources of variation, choose appropriate experimental designs, apply randomization, incorporate blocking, specify statistical models, and determine appropriate sample sizes. Real-world examples and R code snippets will illustrate key ideas. Additionally, we will integrate exercises, class activities, summaries, challenges, and visual aids to reinforce understanding.</p>
</section>
<section id="objectives" class="level1">
<h1>Objectives</h1>
<ol type="1">
<li>Understand how to identify and classify sources of variation in an experiment.</li>
<li>Define treatment factors, factor levels, and experimental units.</li>
<li>Explore blocking, nuisance factors, and strategies to manage them.</li>
<li>Grasp the principles of randomization and why it underpins statistical inference.</li>
<li>Examine standard experimental designs (CRD, RBD, Factorial, Latin Square, Split-Plot) and when to use each.</li>
<li>Understand the distinction between fixed and random effects in modeling.</li>
<li>Learn how to plan data collection, run pilot experiments, and determine the number of observations (sample size).</li>
<li>Gain hands-on experience using R code for randomization, exploratory data analysis, and basic ANOVA.</li>
</ol>
<section id="readings" class="level3">
<h3 class="anchored" data-anchor-id="readings">Readings</h3>
<ul>
<li><span class="citation" data-cites="dean2017">Dean, Voss, and Draguljić (<a href="#ref-dean2017" role="doc-biblioref">2017</a>, Ch. 3)</span></li>
</ul>
</section>
</section>
<section id="checklist-for-experimental-design" class="level1 page-columns page-full">
<h1>Checklist for Experimental Design</h1>
<section id="steps-in-planning-an-experiment" class="level2">
<h2 class="anchored" data-anchor-id="steps-in-planning-an-experiment">Steps in Planning an Experiment</h2>
<p>It is very tempting to jump into data collection without a clear plan. However, a well-thought-out experimental design is crucial for obtaining valid and interpretable results. Here is a checklist of steps to guide you through the planning process:</p>
<section id="define-the-objectives-of-the-experiment" class="level3">
<h3 class="anchored" data-anchor-id="define-the-objectives-of-the-experiment">1. Define the Objectives of the Experiment</h3>
<ul>
<li>Clearly state the goals (e.g., comparing treatments, optimizing factors, studying interactions).</li>
<li>Write objectives as specific questions or hypotheses to guide the design.</li>
</ul>
</section>
<section id="identify-all-sources-of-variation" class="level3">
<h3 class="anchored" data-anchor-id="identify-all-sources-of-variation">2. Identify All Sources of Variation</h3>
<ol type="1">
<li><strong>Treatment Factors and Their Levels</strong>
<ul>
<li>Factors actively manipulated (e.g., temperature, dosage) and their specific levels.</li>
<li>Example: Dosage levels: 10 mg, 20 mg, 30 mg.</li>
</ul></li>
<li><strong>Experimental Units</strong>
<ul>
<li>Smallest division of material receiving a treatment independently.</li>
<li>Example: Individual plants in a field trial.</li>
</ul></li>
<li><strong>Blocking Factors, Noise Factors, and Covariates</strong>
<ul>
<li>Blocking: Group similar units (e.g., day of testing).</li>
<li>Noise: Uncontrollable variability (e.g., weather conditions).</li>
<li>Covariates: Measureable properties (e.g., baseline performance).</li>
</ul></li>
</ol>
<!-- ## Steps in Planning an Experiment (cont'd) -->
</section>
<section id="choose-a-rule-for-assigning-experimental-units-to-treatments" class="level3">
<h3 class="anchored" data-anchor-id="choose-a-rule-for-assigning-experimental-units-to-treatments">3. Choose a Rule for Assigning Experimental Units to Treatments</h3>
<ul>
<li>Select randomization techniques:
<ul>
<li>Completely Randomized Design (CRD).</li>
<li>Randomized Block Design (RBD).</li>
<li>Split-Plot Design.</li>
</ul></li>
</ul>
</section>
<section id="specify-the-measurements-procedure-and-anticipated-difficulties" class="level3">
<h3 class="anchored" data-anchor-id="specify-the-measurements-procedure-and-anticipated-difficulties">4. Specify the Measurements, Procedure, and Anticipated Difficulties</h3>
<ol type="1">
<li><strong>Measurements</strong>
<ul>
<li>Specify precision, units, and frequency of measurement.</li>
<li>Example: Growth in cm, tensile strength in MPa.</li>
</ul></li>
<li><strong>Procedure</strong>
<ul>
<li>Step-by-step instructions for consistent data collection.</li>
</ul></li>
<li><strong>Anticipated Difficulties</strong>
<ul>
<li>Identify challenges (e.g., equipment failure) and mitigation strategies.</li>
</ul></li>
</ol>
<!-- ## Steps in Planning an Experiment (cont'd) -->
</section>
<section id="run-a-pilot-experiment" class="level3">
<h3 class="anchored" data-anchor-id="run-a-pilot-experiment">5. Run a Pilot Experiment</h3>
<ul>
<li>Test feasibility, validate instruments, and refine factor levels or treatment combinations.</li>
</ul>
</section>
<section id="specify-the-statistical-model" class="level3">
<h3 class="anchored" data-anchor-id="specify-the-statistical-model">6. Specify the Statistical Model</h3>
<ul>
<li>Example for one-way ANOVA: <span class="math display">\[
Y_{ij} = \mu + \tau_i + \varepsilon_{ij},
\]</span></li>
</ul>
<p>where:</p>
<ul>
<li><span class="math inline">\(Y_{ij}\)</span>: Observed response.</li>
<li><span class="math inline">\(\mu\)</span>: Overall mean.</li>
<li><span class="math inline">\(\tau_i\)</span>: Treatment effect.</li>
<li><span class="math inline">\(\varepsilon_{ij}\)</span>: Random error term.</li>
</ul>
<!-- ## Steps in Planning an Experiment (cont'd) -->
</section>
<section id="outline-the-analysis" class="level3">
<h3 class="anchored" data-anchor-id="outline-the-analysis">7. Outline the Analysis</h3>
<ul>
<li>Plan descriptive and inferential methods (e.g., ANOVA, regression).</li>
<li>Include diagnostic checks for model assumptions.</li>
</ul>
</section>
<section id="calculate-sample-size" class="level3">
<h3 class="anchored" data-anchor-id="calculate-sample-size">8. Calculate Sample Size</h3>
<ul>
<li>Perform power analysis based on variability estimates and desired precision.</li>
</ul>
</section>
<section id="review-and-revise" class="level3">
<h3 class="anchored" data-anchor-id="review-and-revise">9. Review and Revise</h3>
<ul>
<li>Revisit and refine all decisions based on pilot results and practical constraints.</li>
</ul>
</section>
</section>
<section id="flowchart-of-experimental-design-steps" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="flowchart-of-experimental-design-steps">Flowchart of Experimental Design Steps</h2>
<div class="cell page-columns page-full" data-layout-align="left">
<div class="cell-output-display page-columns page-full">
<div id="fig-doe-plan-flowchart" class="quarto-float quarto-figure quarto-figure-left anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-doe-plan-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<svg width="672" height="480" viewbox="0.00 0.00 431.00 702.40" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" style="; max-width: none; max-height: none">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 698.4)">
<title>ExperimentalDesign</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-698.4 427,-698.4 427,4 -4,4"></polygon>
<g id="clust1" class="cluster">
<title>cluster_planning</title>
<polygon fill="none" stroke="lightblue" points="8,-8 8,-228.8 216,-228.8 216,-8 8,-8"></polygon>
<text text-anchor="middle" x="112" y="-212.2" font-family="Times,serif" font-size="14.00">Planning</text>
</g>
<g id="clust2" class="cluster">
<title>cluster_implementation</title>
<polygon fill="none" stroke="lightgreen" points="159,-465.6 159,-686.4 415,-686.4 415,-465.6 159,-465.6"></polygon>
<text text-anchor="middle" x="287" y="-669.8" font-family="Times,serif" font-size="14.00">Implementation</text>
</g>
<g id="clust3" class="cluster">
<title>cluster_analysis</title>
<polygon fill="none" stroke="orange" points="194,-236.8 194,-457.6 378,-457.6 378,-236.8 194,-236.8"></polygon>
<text text-anchor="middle" x="286" y="-441" font-family="Times,serif" font-size="14.00">Analysis</text>
</g>
<g id="clust4" class="cluster">
<title>cluster_iteration</title>
<polygon fill="none" stroke="lightcoral" points="224,-152 224,-228.8 376,-228.8 376,-152 224,-152"></polygon>
<text text-anchor="middle" x="300" y="-212.2" font-family="Times,serif" font-size="14.00">Iteration</text>
</g>
<!-- Define Objectives -->
<g id="node1" class="node">
<title>Define Objectives</title>
<polygon fill="lightblue" stroke="black" points="190.72,-196 65.28,-196 65.28,-160 190.72,-160 190.72,-196"></polygon>
<text text-anchor="middle" x="128" y="-173.8" font-family="Arial" font-size="14.00">Define Objectives</text>
</g>
<!-- Identify Sources of Variation -->
<g id="node2" class="node">
<title>Identify Sources of Variation</title>
<polygon fill="lightblue" stroke="black" points="207.6,-124 16.4,-124 16.4,-88 207.6,-88 207.6,-124"></polygon>
<text text-anchor="middle" x="112" y="-101.8" font-family="Arial" font-size="14.00">Identify Sources of Variation</text>
</g>
<!-- Define Objectives&#45;&gt;Identify Sources of Variation -->
<g id="edge1" class="edge">
<title>Define Objectives-&gt;Identify Sources of Variation</title>
<path fill="none" stroke="black" d="M124.04,-159.7C122.28,-151.98 120.16,-142.71 118.2,-134.11"></path>
<polygon fill="black" stroke="black" points="121.55,-133.07 115.91,-124.1 114.73,-134.63 121.55,-133.07"></polygon>
</g>
<!-- Choose Assignment Rules -->
<g id="node3" class="node">
<title>Choose Assignment Rules</title>
<polygon fill="lightblue" stroke="black" points="205.47,-52 24.53,-52 24.53,-16 205.47,-16 205.47,-52"></polygon>
<text text-anchor="middle" x="115" y="-29.8" font-family="Arial" font-size="14.00">Choose Assignment Rules</text>
</g>
<!-- Identify Sources of Variation&#45;&gt;Choose Assignment Rules -->
<g id="edge2" class="edge">
<title>Identify Sources of Variation-&gt;Choose Assignment Rules</title>
<path fill="none" stroke="black" d="M112.74,-87.7C113.07,-79.98 113.47,-70.71 113.84,-62.11"></path>
<polygon fill="black" stroke="black" points="117.34,-62.25 114.27,-52.1 110.34,-61.95 117.34,-62.25"></polygon>
</g>
<!-- Specify Measurements &amp; Procedure -->
<g id="node4" class="node">
<title>Specify Measurements &amp; Procedure</title>
<polygon fill="lightgreen" stroke="black" points="407.1,-653.6 166.9,-653.6 166.9,-617.6 407.1,-617.6 407.1,-653.6"></polygon>
<text text-anchor="middle" x="287" y="-631.4" font-family="Arial" font-size="14.00">Specify Measurements &amp; Procedure</text>
</g>
<!-- Choose Assignment Rules&#45;&gt;Specify Measurements &amp; Procedure -->
<g id="edge3" class="edge">
<title>Choose Assignment Rules-&gt;Specify Measurements &amp; Procedure</title>
<path fill="none" stroke="black" d="M205.48,-41.76C290.9,-53.66 406,-86.49 406,-177 406,-492.6 406,-492.6 406,-492.6 406,-533.05 411.38,-549.32 387,-581.6 377,-594.84 362.71,-605.12 348.05,-612.94"></path>
<polygon fill="black" stroke="black" points="346.3,-609.9 338.91,-617.5 349.42,-616.17 346.3,-609.9"></polygon>
</g>
<!-- Identify Anticipated Difficulties -->
<g id="node5" class="node">
<title>Identify Anticipated Difficulties</title>
<polygon fill="lightgreen" stroke="black" points="377.98,-581.6 176.02,-581.6 176.02,-545.6 377.98,-545.6 377.98,-581.6"></polygon>
<text text-anchor="middle" x="277" y="-559.4" font-family="Arial" font-size="14.00">Identify Anticipated Difficulties</text>
</g>
<!-- Specify Measurements &amp; Procedure&#45;&gt;Identify Anticipated Difficulties -->
<g id="edge4" class="edge">
<title>Specify Measurements &amp; Procedure-&gt;Identify Anticipated Difficulties</title>
<path fill="none" stroke="black" d="M284.53,-617.3C283.43,-609.58 282.1,-600.31 280.87,-591.71"></path>
<polygon fill="black" stroke="black" points="284.32,-591.11 279.44,-581.7 277.39,-592.1 284.32,-591.11"></polygon>
</g>
<!-- Run Pilot Experiment -->
<g id="node6" class="node">
<title>Run Pilot Experiment</title>
<polygon fill="lightgreen" stroke="black" points="354.5,-509.6 207.5,-509.6 207.5,-473.6 354.5,-473.6 354.5,-509.6"></polygon>
<text text-anchor="middle" x="281" y="-487.4" font-family="Arial" font-size="14.00">Run Pilot Experiment</text>
</g>
<!-- Identify Anticipated Difficulties&#45;&gt;Run Pilot Experiment -->
<g id="edge5" class="edge">
<title>Identify Anticipated Difficulties-&gt;Run Pilot Experiment</title>
<path fill="none" stroke="black" d="M277.99,-545.3C278.43,-537.58 278.96,-528.31 279.45,-519.71"></path>
<polygon fill="black" stroke="black" points="282.95,-519.89 280.02,-509.7 275.96,-519.49 282.95,-519.89"></polygon>
</g>
<!-- Specify Statistical Model -->
<g id="node7" class="node">
<title>Specify Statistical Model</title>
<polygon fill="orange" stroke="black" points="369.73,-424.8 202.27,-424.8 202.27,-388.8 369.73,-388.8 369.73,-424.8"></polygon>
<text text-anchor="middle" x="286" y="-402.6" font-family="Arial" font-size="14.00">Specify Statistical Model</text>
</g>
<!-- Run Pilot Experiment&#45;&gt;Specify Statistical Model -->
<g id="edge6" class="edge">
<title>Run Pilot Experiment-&gt;Specify Statistical Model</title>
<path fill="none" stroke="black" d="M282.04,-473.44C282.71,-462.34 283.59,-447.65 284.36,-434.98"></path>
<polygon fill="black" stroke="black" points="287.86,-435.13 284.97,-424.93 280.87,-434.71 287.86,-435.13"></polygon>
</g>
<!-- Outline Analysis -->
<g id="node8" class="node">
<title>Outline Analysis</title>
<polygon fill="orange" stroke="black" points="345.38,-352.8 228.62,-352.8 228.62,-316.8 345.38,-316.8 345.38,-352.8"></polygon>
<text text-anchor="middle" x="287" y="-330.6" font-family="Arial" font-size="14.00">Outline Analysis</text>
</g>
<!-- Specify Statistical Model&#45;&gt;Outline Analysis -->
<g id="edge7" class="edge">
<title>Specify Statistical Model-&gt;Outline Analysis</title>
<path fill="none" stroke="black" d="M286.25,-388.5C286.36,-380.78 286.49,-371.51 286.61,-362.91"></path>
<polygon fill="black" stroke="black" points="290.11,-362.95 286.76,-352.9 283.11,-362.85 290.11,-362.95"></polygon>
</g>
<!-- Calculate Sample Size -->
<g id="node9" class="node">
<title>Calculate Sample Size</title>
<polygon fill="orange" stroke="black" points="368.35,-280.8 211.65,-280.8 211.65,-244.8 368.35,-244.8 368.35,-280.8"></polygon>
<text text-anchor="middle" x="290" y="-258.6" font-family="Arial" font-size="14.00">Calculate Sample Size</text>
</g>
<!-- Outline Analysis&#45;&gt;Calculate Sample Size -->
<g id="edge8" class="edge">
<title>Outline Analysis-&gt;Calculate Sample Size</title>
<path fill="none" stroke="black" d="M287.74,-316.5C288.07,-308.78 288.47,-299.51 288.84,-290.91"></path>
<polygon fill="black" stroke="black" points="292.34,-291.05 289.27,-280.9 285.34,-290.75 292.34,-291.05"></polygon>
</g>
<!-- Review and Revise -->
<g id="node10" class="node">
<title>Review and Revise</title>
<polygon fill="lightcoral" stroke="black" points="367.83,-196 232.17,-196 232.17,-160 367.83,-160 367.83,-196"></polygon>
<text text-anchor="middle" x="300" y="-173.8" font-family="Arial" font-size="14.00">Review and Revise</text>
</g>
<!-- Calculate Sample Size&#45;&gt;Review and Revise -->
<g id="edge9" class="edge">
<title>Calculate Sample Size-&gt;Review and Revise</title>
<path fill="none" stroke="black" d="M292.07,-244.64C293.41,-233.54 295.19,-218.85 296.72,-206.18"></path>
<polygon fill="black" stroke="black" points="300.21,-206.48 297.93,-196.13 293.26,-205.64 300.21,-206.48"></polygon>
</g>
<!-- Review and Revise&#45;&gt;Define Objectives -->
<g id="edge10" class="edge">
<title>Review and Revise-&gt;Define Objectives</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M231.76,-178C221.53,-178 211.29,-178 201.06,-178"></path>
<polygon fill="red" stroke="red" points="200.82,-174.5 190.82,-178 200.82,-181.5 200.82,-174.5"></polygon>
</g>
<!-- Review and Revise&#45;&gt;Identify Sources of Variation -->
<g id="edge11" class="edge">
<title>Review and Revise-&gt;Identify Sources of Variation</title>
<path fill="none" stroke="red" stroke-dasharray="5,2" d="M254.01,-159.88C227.85,-150.14 194.91,-137.87 167.35,-127.61"></path>
<polygon fill="red" stroke="red" points="168.43,-124.28 157.84,-124.07 165.99,-130.84 168.43,-124.28"></polygon>
</g>
</g>
</svg>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-doe-plan-flowchart-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Experimental Design Planning Flowchart
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="explaining-experimental-design-concepts" class="level1 page-columns page-full">
<h1>Explaining Experimental Design Concepts</h1>
<section id="identifying-experiment-objectives-and-variation-sources" class="level2">
<h2 class="anchored" data-anchor-id="identifying-experiment-objectives-and-variation-sources">Identifying Experiment Objectives and Variation Sources</h2>
<section id="setting-objectives" class="level3">
<h3 class="anchored" data-anchor-id="setting-objectives">Setting Objectives</h3>
<p>Every experiment must start with a clear research objective. Ask: <em>What do we hope to learn or achieve?</em> Objectives may include:</p>
<ul>
<li>Determining which manufacturing process leads to the highest product quality.</li>
<li>Comparing new teaching methods for improved student performance.</li>
<li>Finding the optimal settings of machine parameters to reduce defects.</li>
</ul>
<p>Without well-defined objectives, the experiment risks being unfocused, making the results difficult to interpret.</p>
</section>
<section id="variation-sources" class="level3">
<h3 class="anchored" data-anchor-id="variation-sources">Variation Sources</h3>
<p>Variation in responses can arise from multiple sources:</p>
<ul>
<li><strong>Major Variation (Treatment Effects):</strong> Due to the factors of interest (e.g., different fertilizers or drug dosages).</li>
<li><strong>Nuisance Factors (noise):</strong> Variables that influence the response but are not of primary interest (e.g., room temperature, operator skill). Some nuisance factors can be controlled or incorporated as blocking factors, while others must be accepted as noise.</li>
</ul>
<p>By identifying and classifying sources of variation, we can decide which factors to manipulate as treatments, which to fix or control, and which to block or treat as covariates.</p>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>Consider an agricultural experiment testing different fertilizer types (A, B, C). The main factors are the fertilizer types. Soil heterogeneity could be a nuisance factor. If the field has varying soil quality, it might mask the fertilizer effect. Recognizing this early allows us to incorporate blocking or other strategies to handle this nuisance variation.</p>
</section>
<section id="activity-work-out-experiment-think-pair-share" class="level3">
<h3 class="anchored" data-anchor-id="activity-work-out-experiment-think-pair-share">Activity (Work Out Experiment): Think-Pair-Share</h3>
<ol type="1">
<li><strong>Think:</strong> Imagine you are testing two workout plans (high-intensity vs.&nbsp;moderate-intensity) to improve muscle strength.</li>
<li><strong>Pair:</strong> Discuss with a partner what the main objective is and what factors could cause unwanted variation (e.g., baseline fitness level, diet).</li>
<li><strong>Share:</strong> Volunteer pairs share their classification of factors and whether they could be controlled or blocked.</li>
</ol>
</section>
<section id="challenges-and-common-mistakes" class="level3">
<h3 class="anchored" data-anchor-id="challenges-and-common-mistakes">Challenges and Common Mistakes</h3>
<ul>
<li>Starting without a clear objective can lead to inconclusive results.</li>
<li>Confusing major variation with nuisance variation can misdirect the design.</li>
</ul>
</section>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">Exercises</h3>
<ol type="1">
<li>Why must objectives be clear before starting an experiment?</li>
<li>Given three fertilizer types and two soil conditions, identify which factors should be considered treatments and which might be nuisance factors.</li>
<li>Explain how failing to control a nuisance factor increases the variance of treatment effect estimates.</li>
</ol>
<p><strong>Key Takeaways:</strong> - Well-defined objectives shape the experiment. - Classifying factors into treatment and nuisance categories enhances design efficiency.</p>
</section>
</section>
<section id="treatment-factors-and-levels" class="level2">
<h2 class="anchored" data-anchor-id="treatment-factors-and-levels">Treatment Factors and Levels</h2>
<section id="defining-treatment-factors" class="level3">
<h3 class="anchored" data-anchor-id="defining-treatment-factors">Defining Treatment Factors</h3>
<p>A <strong>treatment factor</strong> is any variable <strong>deliberately</strong> manipulated by the experimenter to study its effect on the response.</p>
<p><strong>Example:</strong> In a detergent study, water temperature and detergent concentration are treatment factors.</p>
</section>
<section id="factor-levels" class="level3">
<h3 class="anchored" data-anchor-id="factor-levels">Factor Levels</h3>
<p>Factor levels are the specific settings or categories of a factor. For instance, twist levels in a cotton-spinning experiment might be 1.63, 1.69, 1.78, and 1.90 turns per inch. Chosen based on subject matter knowledge, factor levels must be realistic and relevant.</p>
</section>
<section id="activity-baking-experiment-design-your-own-factorial-experiment" class="level3">
<h3 class="anchored" data-anchor-id="activity-baking-experiment-design-your-own-factorial-experiment">Activity (Baking Experiment): Design Your Own Factorial Experiment</h3>
<p>Individually pick a factor (e.g., cooking time) and propose three levels. Pair up with another student who has chosen a different factor (e.g., oven temperature), and combine them into a factorial design. Discuss the complexity and the number of total treatment combinations.</p>
</section>
<section id="challenges-and-common-mistakes-1" class="level3">
<h3 class="anchored" data-anchor-id="challenges-and-common-mistakes-1">Challenges and Common Mistakes</h3>
<ul>
<li>Choosing impractical or irrelevant factor levels can undermine the experiment’s usefulness.</li>
<li>Too many factor levels complicate analysis without necessarily adding insight.</li>
</ul>
</section>
<section id="exercises-1" class="level3">
<h3 class="anchored" data-anchor-id="exercises-1">Exercises</h3>
<ol type="1">
<li>What criteria guide the selection of factor levels?</li>
<li>For a factor with 4 levels and another with 3 levels, determine how many treatment combinations exist.</li>
<li>Explain how replicates per factor level (with total resources fixed) decreases the variance of treatment effect estimates.</li>
</ol>
<p><strong>Key Takeaways:</strong> - Treatments factors are deliberately manipulated variables. - Factor levels must be meaningful, informed by real-world considerations or pilot data.</p>
</section>
</section>
<section id="experimental-units-blocking-and-nuisance-factors" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="experimental-units-blocking-and-nuisance-factors">Experimental Units, Blocking, and Nuisance Factors</h2>
<section id="experimental-units" class="level3">
<h3 class="anchored" data-anchor-id="experimental-units">Experimental Units</h3>
<p>The <strong>experimental unit</strong> is the smallest entity to which treatments are independently assigned. This concept is crucial for valid statistical inference.</p>
</section>
<section id="examples-of-experimental-units" class="level3">
<h3 class="anchored" data-anchor-id="examples-of-experimental-units">Examples of Experimental Units</h3>
<ul>
<li>Plants in a field trial if each plant gets a different fertilizer.</li>
<li>Engine test benches if each engine is run under a unique setup.</li>
<li>Students in a classroom if each student receives a different teaching method.</li>
<li>Patients in a clinical trial if each patient gets a different drug.</li>
</ul>
</section>
<section id="blocking-factors" class="level3">
<h3 class="anchored" data-anchor-id="blocking-factors">Blocking Factors</h3>
<p>When a known nuisance factor could confound results, use <strong>blocking</strong>. Blocking forms groups of similar experimental units, each block receiving all treatments. This controls for block-to-block variation, increasing <em>precision</em>.</p>
<p><strong>Equation (Block Design):</strong></p>
<p><span class="math display">\[
Y_{ij} = \mu + \tau_i + \beta_j + \varepsilon_{ij}
\]</span> {#eq:block-design}</p>
<p>Here, <span class="math inline">\(\tau_i\)</span> is the treatment effect and <span class="math inline">\(\beta_j\)</span> the block effect.</p>
</section>
<section id="noise-factors-and-covariates" class="level3">
<h3 class="anchored" data-anchor-id="noise-factors-and-covariates">Noise Factors and Covariates</h3>
<ul>
<li><strong>Noise Factors:</strong> Uncontrollable variations like daily temperature fluctuations.</li>
<li><strong>Covariates:</strong> Measured continuous variables (e.g., initial weight) that help explain variation when included in the model.</li>
</ul>
</section>
<section id="factor-classification-flowchart" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="factor-classification-flowchart">Factor Classification Flowchart</h3>
<div class="cell page-columns page-full" data-layout-align="left">
<div class="cell-output-display page-columns page-full">
<div id="fig-mermaid" class="quarto-float quarto-figure quarto-figure-left anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-mermaid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div>
<pre class="mermaid mermaid-js" data-label="fig-mermaid">flowchart TD
    A[All Factors]
    B[Interested in studying the effect?]
    C[Treatment Factors]
    D[Nuisance Factors]
    E[Can we group by factor levels?]
    F[Block Factor]
    G[Noise/Uncontrolled Factor]

    A --&gt; B
    B --&gt;|Yes| C
    B --&gt;|No| D
    D --&gt; E
    E --&gt;|Yes| F
    E --&gt;|No| G
</pre>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-fig margin-caption" id="fig-mermaid-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Factor Classification Flowchart
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="activity-blocking-brainstorm" class="level3">
<h3 class="anchored" data-anchor-id="activity-blocking-brainstorm">Activity: Blocking Brainstorm</h3>
<p>Consider a baking experiment where ovens differ in temperature calibration. Could ovens form blocks? Discuss how blocking might improve detection of differences in recipes.</p>
</section>
<section id="challenges-and-common-mistakes-2" class="level3">
<h3 class="anchored" data-anchor-id="challenges-and-common-mistakes-2">Challenges and Common Mistakes</h3>
<ul>
<li>Confusing the experimental unit with observational units leads to incorrect analysis.</li>
<li>Ignoring a known source of variation that could be blocked may inflate residual error.</li>
</ul>
</section>
<section id="exercises-2" class="level3">
<h3 class="anchored" data-anchor-id="exercises-2">Exercises</h3>
<ol type="1">
<li><strong>Conceptual:</strong> Differentiate between experimental and observational units.</li>
<li><strong>Numerical:</strong> If you have 4 treatments and 6 blocks (each block gets all 4 treatments), how many total experimental units are there?</li>
<li><strong>Proof/Derivation:</strong> Show that including a block factor in the model reduces the residual variance compared to an unblocked design.</li>
</ol>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>Correctly identifying experimental units is essential.</li>
<li>Blocking controls known nuisance factors, improving the experiment’s power to detect treatment effects.</li>
</ul>
</section>
</section>
<section id="principles-of-randomization" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="principles-of-randomization">Principles of Randomization</h2>
<section id="randomization-concept" class="level3">
<h3 class="anchored" data-anchor-id="randomization-concept">Randomization Concept</h3>
<p>Randomization ensures that each experimental unit has an equal chance of receiving any treatment. This prevents systematic bias and justifies the assumptions underlying standard statistical tests.</p>
<p><strong>Example:</strong> Use a random number generator to assign treatments to plots, ensuring no predetermined pattern.</p>
</section>
<section id="how-to-perform-randomization" class="level3">
<h3 class="anchored" data-anchor-id="how-to-perform-randomization">How to Perform Randomization</h3>
<p>Randomization ensures unbiased allocation of experimental units to treatments and reduces the risk of systematic error. Here’s how you can perform randomization in practice:</p>
<section id="procedure" class="level4">
<h4 class="anchored" data-anchor-id="procedure"><strong>Procedure</strong></h4>
<ol type="1">
<li><strong>List Experimental Units</strong>:
<ul>
<li>Create a list of all experimental units (e.g., subjects, plots of land).</li>
</ul></li>
<li><strong>List Treatments</strong>:
<ul>
<li>Specify the treatments or factor levels to be assigned.</li>
</ul></li>
<li><strong>Determine Design Type</strong>:
<ul>
<li>Choose a design type: Completely Randomized Design (CRD), Randomized Block Design (RBD), or Split-Plot Design.</li>
</ul></li>
<li><strong>Generate Random Numbers</strong>:
<ul>
<li>Use random number generation to assign treatments to units.</li>
</ul></li>
<li><strong>Assign Treatments</strong>:
<ul>
<li>Pair random numbers with treatments to allocate them to experimental units.</li>
</ul></li>
<li><strong>Verify</strong>:
<ul>
<li>Ensure assignments are correct and check for any unintended patterns.</li>
</ul></li>
</ol>
</section>
</section>
<section id="pseudocode-for-randomization" class="level3">
<h3 class="anchored" data-anchor-id="pseudocode-for-randomization"><strong>Pseudocode for Randomization</strong></h3>
<section id="completely-randomized-design" class="level4">
<h4 class="anchored" data-anchor-id="completely-randomized-design"><strong>Completely Randomized Design</strong></h4>
<pre class="pseudo"><code>INPUT: List of experimental units, List of treatments
OUTPUT: Randomized assignments of treatments to units

1. Define N = Total number of experimental units
2. Define T = List of treatments
3. Repeat T to match the number of experimental units if unbalanced
4. Shuffle the list of treatments randomly
5. Assign shuffled treatments to the experimental units
6. Return randomized assignments</code></pre>
</section>
<section id="randomized-block-design" class="level4">
<h4 class="anchored" data-anchor-id="randomized-block-design"><strong>Randomized Block Design</strong></h4>
<pre class="pseudo"><code>INPUT: List of blocks, List of treatments
OUTPUT: Randomized assignments within each block

1. For each block in blocks:
    a. Shuffle the list of treatments randomly
    b. Assign shuffled treatments to experimental units in the block
2. Combine all block-level assignments
3. Return randomized assignments</code></pre>
</section>
</section>
<section id="r-implementation-randomization-examples" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="r-implementation-randomization-examples">R Implementation: Randomization Examples</h3>
<section id="completely-randomized-design-1" class="level4 page-columns page-full">
<h4 class="anchored" data-anchor-id="completely-randomized-design-1">1. Completely Randomized Design</h4>
<div id="tbl-random-assignment-crd" class="cell quarto-float quarto-figure quarto-figure-left anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-random-assignment-crd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">10</span>  <span class="co"># Number of experimental units</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Define experimental units and treatments</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>experimental_units <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span>n  <span class="co"># 10 experimental units</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>)  <span class="co"># 3 treatments</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat treatments to match the number of units</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">rep</span>(treatments, <span class="at">length.out =</span> n)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Shuffle treatments randomly</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># For reproducibility</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>randomized_treatments <span class="ot">&lt;-</span> <span class="fu">sample</span>(treatments)</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame with randomized assignments</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>randomization_crd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Unit =</span> experimental_units, <span class="at">Treatment =</span> randomized_treatments)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(randomization_crd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Unit Treatment
1     1         C
2     2         A
3     3         B
4     4         B
5     5         C
6     6         C
7     7         A
8     8         A
9     9         B
10   10         A</code></pre>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-random-assignment-crd-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Randomized Assignments in CRD
</figcaption>
</figure>
</div>
</section>
<section id="randomized-block-design-1" class="level4">
<h4 class="anchored" data-anchor-id="randomized-block-design-1"><strong>2. Randomized Block Design</strong></h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define blocks and treatments</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>blocks <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> <span class="co"># 4 blocks</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>) <span class="co"># 3 treatments</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a data frame to store results</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>randomization_rbd <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Block =</span> <span class="fu">integer</span>(), <span class="at">Unit =</span> <span class="fu">integer</span>(), <span class="at">Treatment =</span> <span class="fu">character</span>())</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Randomize within each block</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (block <span class="cf">in</span> blocks) {</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Randomize treatments</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>    randomized_treatments <span class="ot">&lt;-</span> <span class="fu">sample</span>(treatments)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Assign treatments to units within the block</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>    block_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">Block =</span> block,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">Unit =</span> <span class="fu">seq_len</span>(<span class="fu">length</span>(treatments)),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">Treatment =</span> randomized_treatments</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    randomization_rbd <span class="ot">&lt;-</span> <span class="fu">rbind</span>(randomization_rbd, block_data)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(randomization_rbd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Block Unit Treatment
1      1    1         C
2      1    2         A
3      1    3         B
4      2    1         B
5      2    2         A
6      2    3         C
7      3    1         B
8      3    2         C
9      3    3         A
10     4    1         A
11     4    2         B
12     4    3         C</code></pre>
</div>
</div>
</section>
</section>
<section id="explanation-in-r" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="explanation-in-r">Explanation in R</h3>
<ul>
<li><strong><code>rep()</code></strong>: Repeats the treatment list to match the total number of experimental units.</li>
<li><strong><code>sample()</code></strong>: Randomizes the order of the treatments.</li>
<li><strong><code>set.seed()</code></strong>: Ensures reproducibility of the randomization process.</li>
<li><strong><code>for</code> loop (RBD)</strong>: Iterates through blocks, randomizing treatments for each.</li>
</ul>
<p>These R scripts provide easy-to-follow approaches to randomization, ensuring balanced and unbiased treatment assignment. Let me know if you’d like further assistance with advanced designs!</p>

<div class="no-row-height column-margin column-container"><div class="">
<ul>
<li>See the help page for <a href="../appendix/r-base/r-rep-basics.html">rep()</a> in the Appendix for more details.</li>
<li>See the help page for <a href="../appendix/r-base/r-sample-basic.html">sample()</a> in the Appendix for more details.</li>
</ul>
</div></div></section>
<section id="r-example-simple-random-assignment" class="level3">
<h3 class="anchored" data-anchor-id="r-example-simple-random-assignment">R Example: Simple Random Assignment</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>), <span class="at">each=</span><span class="dv">4</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>assignments <span class="ot">&lt;-</span> <span class="fu">sample</span>(treatments)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>assignments</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "A" "C" "C" "A" "B" "C" "B" "A" "C" "B" "A" "B"</code></pre>
</div>
</div>
</section>
<section id="activity-randomization-drill" class="level3">
<h3 class="anchored" data-anchor-id="activity-randomization-drill">Activity: Randomization Drill</h3>
<p>Write down three treatments on slips of paper and randomly assign them to hypothetical units. Discuss how randomization prevents biased placement of favorable treatments.</p>
</section>
<section id="challenges-and-common-mistakes-3" class="level3">
<h3 class="anchored" data-anchor-id="challenges-and-common-mistakes-3">Challenges and Common Mistakes</h3>
<ul>
<li>Assigning treatments alphabetically or in a patterned manner is not randomization.</li>
<li>Randomization must be deliberate, not haphazard.</li>
</ul>
</section>
<section id="exercises-3" class="level3">
<h3 class="anchored" data-anchor-id="exercises-3">Exercises</h3>
<ol type="1">
<li>Why is randomization crucial for valid statistical inference?</li>
<li>With 12 units and 3 treatments, show one method of random assignment.</li>
<li>Under randomization and the null hypothesis, show that the expected difference between treatment means is zero.</li>
</ol>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>Randomization removes systematic bias.</li>
<li>It underpins the validity of ANOVA and other inferential methods.</li>
</ul>
</section>
</section>
<section id="standard-experimental-designs" class="level2">
<h2 class="anchored" data-anchor-id="standard-experimental-designs">Standard Experimental Designs</h2>
<section id="completely-randomized-design-crd" class="level3">
<h3 class="anchored" data-anchor-id="completely-randomized-design-crd">Completely Randomized Design (CRD)</h3>
<ul>
<li>No blocking, treatments assigned entirely at random.</li>
<li>Suitable when units are homogeneous.</li>
</ul>
</section>
<section id="randomized-block-design-rbd" class="level3">
<h3 class="anchored" data-anchor-id="randomized-block-design-rbd">Randomized Block Design (RBD)</h3>
<ul>
<li>Introduce a blocking factor to control known variation.</li>
<li>Each block receives all treatments, improving the precision of treatment comparisons.</li>
</ul>
</section>
<section id="row-column-and-latin-squares" class="level3">
<h3 class="anchored" data-anchor-id="row-column-and-latin-squares">Row-Column and Latin Squares</h3>
<ul>
<li>Control for two perpendicular nuisance factors simultaneously.</li>
</ul>
</section>
<section id="factorial-designs" class="level3">
<h3 class="anchored" data-anchor-id="factorial-designs">Factorial Designs</h3>
<ul>
<li>Study multiple factors and their interactions simultaneously.</li>
<li>Efficiently explore how factors work together.</li>
</ul>
</section>
<section id="split-plot-designs" class="level3">
<h3 class="anchored" data-anchor-id="split-plot-designs">Split-Plot Designs</h3>
<ul>
<li>Useful when some factors are harder to change than others.</li>
<li>Creates a hierarchy of experimental units (e.g., fields as main plots and subplots within fields).</li>
</ul>
</section>
<section id="activity-design-match-up" class="level3">
<h3 class="anchored" data-anchor-id="activity-design-match-up">Activity: Design Match-Up</h3>
<p>Given three scenarios (no nuisance factor, known nuisance factor, and multiple factors with a complex structure), choose the appropriate design (CRD, RBD, Factorial, Latin Square).</p>
</section>
<section id="challenges-and-common-mistakes-4" class="level3">
<h3 class="anchored" data-anchor-id="challenges-and-common-mistakes-4">Challenges and Common Mistakes</h3>
<ul>
<li>Using a CRD when a known nuisance factor should be blocked.</li>
<li>Ignoring interactions in factorial experiments.</li>
</ul>
</section>
<section id="exercises-4" class="level3">
<h3 class="anchored" data-anchor-id="exercises-4">Exercises</h3>
<ol type="1">
<li><strong>Conceptual:</strong> Under what conditions would you choose a CRD over an RBD?</li>
<li><strong>Numerical:</strong> Compute the number of runs in a 2x4 factorial with 3 replicates.</li>
<li><strong>Proof/Derivation:</strong> Show how the variance decomposition changes from CRD to RBD, highlighting the block effect.</li>
</ol>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>Different designs address different research needs.</li>
<li>Factorial designs detect interactions, blocking improves precision, and split-plots handle difficult-to-change factors.</li>
</ul>
</section>
</section>
<section id="model-specification-and-effect-types" class="level2">
<h2 class="anchored" data-anchor-id="model-specification-and-effect-types">Model Specification and Effect Types</h2>
<section id="linear-models-and-anova" class="level3">
<h3 class="anchored" data-anchor-id="linear-models-and-anova">Linear Models and ANOVA</h3>
<p>Experiments often use a linear model to relate responses to treatments and blocks:</p>
<p><span class="math display">\[
Y = \mu + \text{treatment effects} + \text{block effects} + \text{error}
\]</span> {#eq:linear-model}</p>
<p>ANOVA decomposes total variation into components attributable to treatments, blocks, and error, enabling inference on treatment effects.</p>
</section>
<section id="fixed-vs.-random-effects" class="level3">
<h3 class="anchored" data-anchor-id="fixed-vs.-random-effects">Fixed vs.&nbsp;Random Effects</h3>
<ul>
<li><strong>Fixed Effects:</strong> Chosen levels of interest; inferences apply only to those tested levels.</li>
<li><strong>Random Effects:</strong> Levels are a random sample from a broader population; inferences generalize beyond observed levels.</li>
</ul>
</section>
<section id="activity-fixed-or-random" class="level3">
<h3 class="anchored" data-anchor-id="activity-fixed-or-random">Activity: Fixed or Random?</h3>
<p>Consider an experiment with 3 specific fertilizer brands (likely fixed) vs.&nbsp;an experiment using 3 randomly chosen brands from a large market (random). Discuss how interpretation changes.</p>
</section>
<section id="challenges-and-common-mistakes-5" class="level3">
<h3 class="anchored" data-anchor-id="challenges-and-common-mistakes-5">Challenges and Common Mistakes</h3>
<ul>
<li>Treating random factors as fixed or vice versa leads to incorrect conclusions.</li>
<li>Confusing the meaning of random effects with randomization.</li>
</ul>
</section>
<section id="exercises-5" class="level3">
<h3 class="anchored" data-anchor-id="exercises-5">Exercises</h3>
<ol type="1">
<li><strong>Conceptual:</strong> Why is it important to distinguish fixed and random effects?</li>
<li><strong>Numerical:</strong> In an RBD, show how expected mean squares differ for a random block factor vs.&nbsp;a fixed block factor.</li>
<li><strong>Proof/Derivation:</strong> Derive the expected mean squares for a two-way ANOVA with one random factor.</li>
</ol>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>Correct model specification ensures valid inference.</li>
<li>Fixed vs.&nbsp;random distinction affects interpretation and generalized conclusions.</li>
</ul>
</section>
</section>
<section id="planning-data-collection-and-pilot-experiments" class="level2">
<h2 class="anchored" data-anchor-id="planning-data-collection-and-pilot-experiments">Planning Data Collection and Pilot Experiments</h2>
<section id="measurement-and-procedure" class="level3">
<h3 class="anchored" data-anchor-id="measurement-and-procedure">Measurement and Procedure</h3>
<p>Careful data collection planning ensures relevance and quality:</p>
<ul>
<li>Choose appropriate measurement scales and ensure instruments are calibrated.</li>
<li>Train personnel to reduce measurement errors.</li>
</ul>
</section>
<section id="pilot-experiments" class="level3">
<h3 class="anchored" data-anchor-id="pilot-experiments">Pilot Experiments</h3>
<p>A small-scale pilot run can identify unforeseen difficulties, refine factor levels, and confirm data collection procedures before launching the main study.</p>
</section>
<section id="activity-pilot-study-discussion" class="level3">
<h3 class="anchored" data-anchor-id="activity-pilot-study-discussion">Activity: Pilot Study Discussion</h3>
<p>Discuss what a pilot experiment might reveal in a crop study (e.g., unexpected soil pests) and how that influences the main experiment’s design.</p>
</section>
<section id="challenges-and-common-mistakes-6" class="level3">
<h3 class="anchored" data-anchor-id="challenges-and-common-mistakes-6">Challenges and Common Mistakes</h3>
<ul>
<li>Omitting a pilot study can lead to costly mistakes in the main experiment.</li>
<li>Relying on untested procedures risks invalid data collection.</li>
</ul>
</section>
<section id="exercises-6" class="level3">
<h3 class="anchored" data-anchor-id="exercises-6">Exercises</h3>
<ol type="1">
<li>Why are pilot experiments beneficial?</li>
<li>If pilot data suggest variance = 4 and you want a margin of error = 1, how many samples per treatment are needed (assuming normality)?</li>
<li>Show how a pilot-based variance estimate informs sample size calculations.</li>
</ol>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>Planning and pilot testing prevent wasted resources.</li>
<li>Well-designed procedures and preliminary runs ensure high-quality, interpretable data.</li>
</ul>
</section>
</section>
<section id="determining-the-number-of-observations" class="level2">
<h2 class="anchored" data-anchor-id="determining-the-number-of-observations">Determining the Number of Observations</h2>
<section id="sample-size-and-power" class="level3">
<h3 class="anchored" data-anchor-id="sample-size-and-power">Sample Size and Power</h3>
<p>The number of observations affects the experiment’s ability to detect true effects:</p>
<ul>
<li><strong>Power:</strong> Probability of detecting a true effect if it exists.</li>
<li>Larger sample size generally increases power but also increases cost.</li>
</ul>
<p>Power calculations balance desired precision, variance estimates, and available resources.</p>
</section>
<section id="activity-sample-size-calculation" class="level3">
<h3 class="anchored" data-anchor-id="activity-sample-size-calculation">Activity: Sample Size Calculation</h3>
<p>Given an estimated variance and a desired effect size, estimate the required sample size. Discuss trade-offs between resource constraints and statistical power.</p>
</section>
<section id="challenges-and-common-mistakes-7" class="level3">
<h3 class="anchored" data-anchor-id="challenges-and-common-mistakes-7">Challenges and Common Mistakes</h3>
<ul>
<li>Choosing sample size arbitrarily can lead to low power or wasted resources.</li>
<li>Overly large samples may be unnecessary and expensive.</li>
</ul>
</section>
<section id="exercises-7" class="level3">
<h3 class="anchored" data-anchor-id="exercises-7">Exercises</h3>
<ol type="1">
<li><strong>Conceptual:</strong> Explain why sample size must be justified.</li>
<li><strong>Numerical:</strong> Given effect size = 2 (SD=3) and desired power = 0.8, calculate required sample size per group.</li>
<li><strong>Proof/Derivation:</strong> Derive a basic formula relating power, effect size, and sample size for a one-way ANOVA.</li>
</ol>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>Adequate sample size ensures meaningful, reliable conclusions.</li>
<li>Power analysis guides optimal resource allocation.</li>
</ul>
</section>
</section>
<section id="practical-example-in-r" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="practical-example-in-r">Practical Example in R</h2>
<section id="example-a-simple-crd" class="level3">
<h3 class="anchored" data-anchor-id="example-a-simple-crd">Example: A Simple CRD</h3>
<p>Compare three battery types (A, B, C) with 4 replicates each.</p>
</section>
<section id="r-code" class="level3 page-columns page-full">
<h3 class="anchored" data-anchor-id="r-code">R Code</h3>
<div id="tbl-anova-example" class="cell quarto-float quarto-figure quarto-figure-left anchored page-columns page-full">
<figure class="quarto-float quarto-float-tbl figure page-columns page-full">
<div aria-describedby="tbl-anova-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>treatments <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>), <span class="at">each =</span> <span class="dv">4</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>assignments <span class="ot">&lt;-</span> <span class="fu">sample</span>(treatments)</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate some response data</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>response <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">12</span>, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit ANOVA model</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">aov</span>(response <span class="sc">~</span> <span class="fu">factor</span>(assignments))</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Df Sum Sq Mean Sq F value Pr(&gt;F)
factor(assignments)  2   14.2    7.08   0.163  0.852
Residuals            9  391.5   43.50               </code></pre>
</div>
</div>
<figcaption class="quarto-float-caption-margin quarto-float-caption quarto-float-tbl margin-caption" id="tbl-anova-example-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: ANOVA Table
</figcaption>
</figure>
</div>
<p>Interpret the ANOVA table:</p>
<ul>
<li>If the p-value for factor(assignments) is small, it suggests a difference among battery types.</li>
</ul>
</section>
<section id="activity-interpret-r-output" class="level3">
<h3 class="anchored" data-anchor-id="activity-interpret-r-output">Activity: Interpret R Output</h3>
<p>Examine the ANOVA table. Identify the F-statistic and p-value, and discuss whether treatments differ.</p>
</section>
<section id="challenges-and-common-mistakes-8" class="level3">
<h3 class="anchored" data-anchor-id="challenges-and-common-mistakes-8">Challenges and Common Mistakes</h3>
<ul>
<li>Misinterpreting p-values without context.</li>
<li>Ignoring model assumptions such as normality and equal variances.</li>
</ul>
</section>
<section id="exercises-8" class="level3">
<h3 class="anchored" data-anchor-id="exercises-8">Exercises</h3>
<ol type="1">
<li><strong>Conceptual:</strong> Explain why randomization is essential before running ANOVA.</li>
<li><strong>Numerical:</strong> Modify the code for 2 treatments with 5 replicates and interpret results.</li>
<li><strong>Proof/Derivation:</strong> Show how the F-statistic relates to the ratio of variances in ANOVA.</li>
</ol>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>R facilitates practical application of design concepts.</li>
<li>Interpreting software output requires understanding design principles and model assumptions.</li>
</ul>
</section>
</section>
<section id="summary-of-key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="summary-of-key-takeaways">Summary of Key Takeaways</h2>
<ul>
<li><strong>Objectives:</strong> Clear objectives guide the entire design and analysis.</li>
<li><strong>Factors and Levels:</strong> Treatment factors and meaningful factor levels ensure relevance.</li>
<li><strong>Experimental Units and Blocking:</strong> Correct identification of units and use of blocking increases precision.</li>
<li><strong>Randomization:</strong> Ensures unbiased estimates and valid statistical inference.</li>
<li><strong>Designs (CRD, RBD, Factorial, etc.):</strong> Different designs solve different problems; factorial designs explore interactions, blocking controls known variation.</li>
<li><strong>Fixed vs.&nbsp;Random Effects:</strong> Proper classification determines the scope of inferences.</li>
<li><strong>Planning and Pilots:</strong> Thoughtful planning and preliminary trials prevent costly errors.</li>
<li><strong>Sample Size and Power:</strong> Adequate sample size ensures detectable effects without wasting resources.</li>
<li><strong>R Implementation:</strong> Practical coding examples reinforce theoretical principles.</li>
</ul>
</section>
<section id="definitions-of-key-terms" class="level2">
<h2 class="anchored" data-anchor-id="definitions-of-key-terms">Definitions of Key Terms</h2>
<ul>
<li><strong>Objective:</strong> The main research question or goal of the experiment.</li>
<li><strong>Nuisance Factor:</strong> A variable that affects the response but is not of primary interest.</li>
<li><strong>Treatment Factor:</strong> A variable manipulated by the experimenter.</li>
<li><strong>Factor Levels:</strong> The specific settings or categories of a factor.</li>
<li><strong>Experimental Unit:</strong> The entity to which a treatment is applied independently.</li>
<li><strong>Block Factor:</strong> A factor used to group units into homogeneous sets.</li>
<li><strong>Randomization:</strong> Assigning treatments randomly to avoid bias.</li>
<li><strong>CRD (Completely Randomized Design):</strong> A design without blocking; treatments are assigned randomly.</li>
<li><strong>RBD (Randomized Block Design):</strong> A design that uses blocks to control known nuisance factors.</li>
<li><strong>Factorial Design:</strong> A design that includes multiple factors simultaneously.</li>
<li><strong>Fixed Effects:</strong> Effects of chosen factor levels of specific interest.</li>
<li><strong>Random Effects:</strong> Effects of factor levels considered as a random sample from a population.</li>
<li><strong>Pilot Experiment:</strong> A small preliminary study to refine methods before the main experiment.</li>
<li><strong>Power:</strong> The probability of detecting a true treatment effect.</li>
<li><strong>ANOVA:</strong> A statistical method for comparing means across groups.</li>
</ul>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-dean2017" class="csl-entry" role="listitem">
Dean, Angela, Daniel Voss, and Danel Draguljić. 2017. <em>Design and Analysis of Experiments</em>. 2nd ed. Springer <span>Texts</span> in <span>Statistics</span>. Cham, Switzerland: Springer International Publishing. <a href="https://doi.org/10.1007/978-3-319-52250-0">https://doi.org/10.1007/978-3-319-52250-0</a>.
</div>
</div></section><section class="quarto-appendix-contents" id="quarto-copyright"><h2 class="anchored quarto-appendix-heading">Copyright</h2><div class="quarto-appendix-contents"><div>Davood Tofighi, Ph.D.</div></div></section></div></main> <!-- /main -->
<!-- filepath: /Users/dt/Library/CloudStorage/Dropbox/Teaching/DOE/assets/includes/footer.html -->
<footer class="site-footer">
    <div class="container text-center">
        <hr> 
        © <span id="current-year"></span> Dr. Davood Tofighi |
        <a href="https://canvasinfo.unm.edu/">UNM Canvas</a> |
        <a href="https://data-wise.github.io/doe">Course GitHub Page</a> |
    </div>
    <script>
        document.getElementById("current-year").textContent = new Date().getFullYear();
    </script>
</footer>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Data-Wise\.github\.io\/doe\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>